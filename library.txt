
CREATE TABLE PUBLISHER
(NAME VARCHAR(20) PRIMARY KEY,
PHONE INTEGER,
ADDRESS VARCHAR(20));

CREATE TABLE BOOK
(BOOK_ID INTEGER PRIMARY KEY,
TITLE VARCHAR(20),
PUB_YEAR VARCHAR(20),
PUB_NAME VARCHAR(20),
FOREIGN KEY (PUB_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE);

CREATE TABLE BOOK_AUTHORS
(AUTHOR_NAME VARCHAR(20),
BOOK_ID INTEGER,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
PRIMARY KEY(BOOK_ID, AUTHOR_NAME));

CREATE TABLE LIBRARY_PROGRAMME
(PROGRAMME_ID INTEGER PRIMARY KEY,
PROGRAMME_NAME VARCHAR(50),
ADDRESS VARCHAR(50));

CREATE TABLE BOOK_COPIES
(NO_OF_COPIES INTEGER,
BOOK_ID INTEGER,
PROGRAMME_ID INTEGER,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY(PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME(PROGRAMME_ID) ON DELETE CASCADE,
PRIMARY KEY (BOOK_ID,PROGRAMME_ID));

CREATE TABLE CARD
(CARD_NO INTEGER PRIMARY KEY);

CREATE TABLE BOOK_LENDING
(BOOK_ID INTEGER,
PROGRAMME_ID INTEGER,
CARD_NO INTEGER,
DATE_OUT DATE,
DUE_DATE DATE,
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
FOREIGN KEY (PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME(PROGRAMME_ID) ON DELETE CASCADE,
FOREIGN KEY (CARD_NO) REFERENCES CARD(CARD_NO) ON DELETE CASCADE,
PRIMARY KEY (BOOK_ID,PROGRAMME_ID,CARD_NO));


INSERT INTO PUBLISHER VALUES('praful', 987654321, 'INDIA');
INSERT INTO PUBLISHER VALUES('akarsh', 987654322, 'INDIA');
INSERT INTO PUBLISHER VALUES('anshul', 987654323, 'INDIA');
INSERT INTO PUBLISHER VALUES('abhishek',987654324, 'INDIA');
INSERT INTO PUBLISHER VALUES('anant', 987654325, 'INDIA');

INSERT INTO BOOK VALUES(6, 'JAVA', 'FEB-2019', 'praful');
INSERT INTO BOOK VALUES(7, 'PYTHON ', 'AUG-2020', 'akarsh');
INSERT INTO BOOK VALUES(8, 'CPP', 'OCT-2017', 'anshul');
INSERT INTO BOOK VALUES(9, 'DATA', 'JAN-2016', 'abhishek');
INSERT INTO BOOK VALUES(10, 'WEB', 'JUL-2018', 'anant');

INSERT INTO BOOK_AUTHORS VALUES('ANANT1', 6);
INSERT INTO BOOK_AUTHORS VALUES('ANANT2', 7);
INSERT INTO BOOK_AUTHORS VALUES('ANANT3', 8);
INSERT INTO BOOK_AUTHORS VALUES('ANANT4', 9);
INSERT INTO BOOK_AUTHORS VALUES('ANANT5', 10);

INSERT INTO LIBRARY_PROGRAMME VALUES(100,'BAGALUR','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(101,'BAGALUR','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(102,'BAGALUR','BANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(103,'BAGALUR NAGAR','MANGALORE');
INSERT INTO LIBRARY_PROGRAMME VALUES(104,'BAGALUR','UDUPI');

INSERT INTO BOOK_COPIES VALUES(10, 6, 100);
INSERT INTO BOOK_COPIES VALUES(16, 6, 101);
INSERT INTO BOOK_COPIES VALUES(20, 7, 102);
INSERT INTO BOOK_COPIES VALUES(6, 8, 103);
INSERT INTO BOOK_COPIES VALUES(4, 9, 104);
INSERT INTO BOOK_COPIES VALUES(7, 10, 100);
INSERT INTO BOOK_COPIES VALUES(3, 9, 101);

INSERT INTO CARD VALUES(501);
INSERT INTO CARD VALUES(502);
INSERT INTO CARD VALUES(503);
INSERT INTO CARD VALUES(504);


INSERT INTO BOOK_LENDING VALUES(6, 100, 501, '2017-01-01','2017-01-31');
INSERT INTO BOOK_LENDING VALUES(8, 104, 501, '2017-01-11','2017-03-01');
INSERT INTO BOOK_LENDING VALUES(7, 103, 501, '2017-02-21','2017-04-21');
INSERT INTO BOOK_LENDING VALUES(9, 101, 501, '2017-03-11','2017-06-11');
INSERT INTO BOOK_LENDING VALUES(6, 101, 504, '2017-04-09','2017-07-08');


SELECT * FROM PUBLISHER;
SELECT * FROM BOOK;
SELECT * FROM BOOK_AUTHORS;
SELECT * FROM LIBRARY_PROGRAMME;
SELECT * FROM BOOK_COPIES;
SELECT * FROM CARD;
SELECT * FROM BOOK_LENDING;




SELECT B.BOOK_ID, B.TITLE, B.PUB_NAME, A.AUTHOR_NAME,C.NO_OF_COPIES,L.PROGRAMME_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAMME L
WHERE B.BOOK_ID=A.BOOK_ID
AND B.BOOK_ID=C.BOOK_ID
AND L.PROGRAMME_ID=C.PROGRAMME_ID;


SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-06-01'
GROUP BY CARD_NO
HAVING COUNT(*)>3;


DELETE FROM BOOK
WHERE BOOK_ID=3; 

SELECT * FROM BOOK;

SELECT * FROM BOOK_AUTHORS;



CREATE VIEW V_PUBLICATION AS SELECT
PUB_YEAR
FROM BOOK; 

SELECT * FROM V_PUBLICATION;



CREATE VIEW V_BOOKS AS
SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES
FROM
BOOK B, BOOK_COPIES C, LIBRARY_PROGRAMME L
WHERE B.BOOK_ID=C.BOOK_ID
AND C.PROGRAMME_ID=L.PROGRAMME_ID;

SELECT * FROM V_BOOKS;


















